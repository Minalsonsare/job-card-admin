<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Console - Job Card App</title>
<!-- Bootstrap CSS (CDN) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<!-- Optional: Add Bootstrap Icons (CDN) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<!-- Google Fonts (Optional - for Roboto) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<!-- Custom Styles -->
<style>
body {
background-color: #f8f9fa; /* Light gray background */
font-family: 'Roboto', sans-serif; /* Cleaner font */
color: #343a40; /* Darker text color */
}
.sidebar {
background-color: #ffffff; /* White sidebar */
height: 100vh;
padding: 1.5rem 1rem; /* Slightly less padding */
border-right: 1px solid #dee2e6; /* Softer border */
position: fixed;
width: 240px; /* Slightly wider */
overflow-y: auto;
box-shadow: 2px 0 5px rgba(0,0,0,0.05); /* Subtle shadow */
z-index: 1000; /* Ensure sidebar stays on top */
}
.sidebar .logo {
    display: block; /* Make logo a block element */
    margin: 0 auto 1.5rem auto; /* Center logo and add margin below */
    text-align: center; /* Center image if container is wider */
}

.sidebar a {
display: flex; /* Use flexbox for alignment */
align-items: center; /* Vertically center icon and text */
padding: 0.8rem 1rem; /* Adjust padding */
margin-bottom: 0.5rem;
color: #495057; /* Slightly lighter gray for inactive links */
text-decoration: none;
border-radius: 8px; /* More rounded corners */
font-weight: 500;
transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; /* Smooth transition */
}
.sidebar a:hover {
background-color: #e9ecef; /* Light background on hover */
color: #007bff; /* Blue text on hover */
}
.sidebar a.active {
background-color: #007BFF;
color: white;
font-weight: bold; /* Bold active link */
box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3); /* Subtle shadow for active link */
}
.sidebar a i {
margin-right: 0.8rem; /* More space after icon */
font-size: 1.1rem; /* Slightly larger icons */
width: 20px; /* Fixed width for alignment */
text-align: center;
transition: transform 0.2s ease; /* Add transition for icon */
}
.sidebar a:hover i {
 transform: scale(1.1); /* Slightly scale icon on hover */
}

.dashboard-content {
margin-left: 240px; /* Adjusted for wider sidebar */
padding: 2rem;
}
.content-section {
padding: 25px; /* More padding */
background-color: #ffffff;
margin-bottom: 25px; /* More space between sections */
border-radius: 8px; /* Consistent rounded corners */
box-shadow: 0 0.2rem 0.5rem rgba(0, 0, 0, 0.075);
border: 1px solid #dee2e6; /* Add subtle border */
}
/* Common styles for section headers */
.section-header { /* Wrapper for H2 and HR if needed */
     margin-bottom: 1.5rem;
}
.section-header h2,
.content-section h2 { /* Apply to both scenarios */
    color: #0056b3; /* Darker blue for headings */
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    font-weight: 500; /* Medium weight */
}
.section-header h2 i,
.content-section h2 i {
    margin-right: 0.6rem;
    color: #007bff; /* Match primary color */
}
.section-header hr,
.content-section hr {
    margin-top: 0.5rem;
    margin-bottom: 1.5rem; /* Control space after hr */
    border-top: 1px solid #dee2e6;
}

.card {
border: 1px solid #e9ecef; /* Very light card border */
border-radius: 8px;
box-shadow: 0 1px 3px rgba(0,0,0,0.04); /* Subtle shadow on cards */
transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
background-color: #ffffff;
overflow: hidden; /* Needed for border-radius with inner elements */
}
.card:hover {
    transform: translateY(-3px); /* Slight lift on hover */
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.card h5.card-title {
    color: #0056b3;
    font-weight: 500;
    font-size: 1.1rem;
}
.card .badge {
    font-size: 0.7rem; /* Smaller badges */
    vertical-align: middle;
    margin-left: 5px;
    padding: 0.3em 0.5em;
    font-weight: 500;
}
/* Specific badge colors if desired */
.badge.bg-info { background-color: #17a2b8 !important; color: white !important; }
.badge.bg-success { background-color: #28a745 !important; color: white !important; }

.navbar {
background-color: #ffffff !important;
border-bottom: 1px solid #dee2e6;
box-shadow: 0 2px 4px rgba(0,0,0,0.04);
border-radius: 8px; /* Rounded corners for navbar */
margin-bottom: 2rem; /* Space below navbar */
}
.navbar-brand {
    font-weight: 500;
    color: #0056b3 !important;
}

/* Style for role simulation buttons */
.role-view-selector .btn {
    font-size: 0.8rem; /* Even smaller */
    padding: 0.4rem 0.8rem; /* Adjust padding */
    display: inline-flex; /* Align icon and text */
    align-items: center;
    border-radius: 6px !important; /* Ensure consistent rounding */
}
.role-view-selector .btn i {
    margin-right: 0.4rem;
    font-size: 0.9rem;
}
.role-view-selector .btn-check + .btn-outline-secondary:hover {
    background-color: #e9ecef;
    color: #0056b3;
}
.role-view-selector .btn-check:checked + .btn-outline-secondary {
    background-color: #6c757d; /* Darker gray for selected non-primary */
    color: white;
    border-color: #6c757d;
}

/* Criteria Column styles */
.criteria-column {
    padding-left: 15px;
    padding-right: 15px;
}
.criteria-column .column-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; /* Allow button to wrap on small screens */
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6; /* Softer bottom border */
}
.criteria-column h3 {
    font-size: 1.2rem; /* Slightly smaller */
    color: #495057;
    margin-bottom: 0;
    display: flex;
    align-items: center;
    font-weight: 500;
    border-bottom: none; /* Remove previous border */
}
.criteria-column h3 i {
    margin-right: 0.5rem;
    font-size: 1.3rem; /* Make icon slightly larger */
}
.criteria-column .btn-add-criteria {
    font-size: 0.8rem;
    padding: 0.35rem 0.7rem;
    margin-top: 0.5rem; /* Add margin if it wraps */
    margin-left: auto; /* Push to right if space allows */
}
.criteria-column .card .card-body {
    padding: 1rem; /* Slightly less padding inside cards */
}
.criteria-column .card small.text-muted {
    font-size: 0.8rem;
}
.criteria-column .card strong {
    font-weight: 500; /* Medium weight for rule label */
}
.criteria-column .card .text-end .btn {
    opacity: 0.8; /* Make action buttons slightly subtle */
    transition: opacity 0.2s ease;
}
.criteria-column .card:hover .text-end .btn {
    opacity: 1; /* Show fully on card hover */
}


/* Modal styles */
.modal-header {
    background-color: #e9ecef; /* Lighter header */
    border-bottom: 1px solid #dee2e6;
    padding: 1rem 1.5rem;
}
.modal-title {
    color: #343a40; /* Darker title */
    font-weight: 500;
}
.modal-body {
    padding: 1.5rem;
}
.modal-footer {
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
    padding: 0.75rem 1.5rem;
}
/* Required field indicator */
.form-label .text-danger {
    font-size: 0.9em;
    vertical-align: super;
}

/* Table Enhancements */
.table {
    border: 1px solid #dee2e6; /* Add border around table */
    border-radius: 8px; /* Rounded corners */
    overflow: hidden; /* Clip content to rounded corners */
}
.table thead th {
    background-color: #f8f9fa; /* Lighter header */
    color: #495057;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
    white-space: nowrap; /* Prevent header text wrapping */
}
.table tbody tr {
    border-top: 1px solid #dee2e6; /* Add row separator */
}
.table tbody tr:first-child {
    border-top: none; /* Remove top border for first row */
}
.table-hover > tbody > tr:hover {
    background-color: #eef2f7; /* Slightly blue tint on hover */
}
.table .btn-sm i {
    font-size: 1rem; /* Slightly larger icons in buttons */
}

/* Hide sections initially */
section:not(#dashboard-section) {
    display: none;
}
/* Ensure dashboard is visible on load */
#dashboard-section {
    display: block;
}

/* Utility for subtle text */
.text-muted-light {
    color: #86909c !important;
}

</style>
</head>
<body>
<div class="sidebar">
    <div class="logo">
         <img src="Group 1000008859.png" alt="Logo" height="45" width="160" class="mb-4"> <!-- Adjusted size/margin -->
    </div>
    <a href="#dashboard" class="nav-link active" id="nav-dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="#users" class="nav-link" id="nav-users"><i class="bi bi-people-fill"></i>Manage Users</a>
    <a href="#porder" class="nav-link" id="nav-porder"><i class="bi bi-filter-square-fill"></i>Manage Criteria</a>
    <!-- Removed ATS Link as per user's code -->
    <a href="#"><i class="bi bi-box-arrow-right"></i> Logout</a>
</div>
<div class="dashboard-content">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand ms-2" href="#">AI Job Card - Admin Console</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavContent" aria-controls="navbarNavContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="content-section">
         <div class="section-header">
            <h2><i class="bi bi-speedometer2"></i> Dashboard</h2>
            <hr>
        </div>
        <p class="lead text-muted-light mb-4">Welcome to the Admin Console. Overview of system status and key metrics.</p> <!-- Lead paragraph -->
         <div class="row">
            <div class="col-lg-6 mb-4"> <!-- Changed breakpoint, increased bottom margin -->
                <div class="card text-center h-100">
                    <div class="card-body d-flex flex-column justify-content-between p-4"> <!-- More padding -->
                        <div>
                            <h5 class="card-title mb-3"><i class="bi bi-people-fill me-2"></i> Active Users</h5>
                            <p class="card-text display-4 fw-bold text-primary" id="user-count">2</p>
                        </div>
                        <button class="btn btn-primary mt-3" onclick="showSection('users-section', 'nav-users')">Manage Users <i class="bi bi-arrow-right-short"></i></button> <!-- Changed to primary button -->
                    </div>
                </div>
            </div>
             <div class="col-lg-6 mb-4"> <!-- Changed breakpoint, increased bottom margin -->
                <div class="card text-center h-100">
                     <div class="card-body d-flex flex-column justify-content-between p-4"> <!-- More padding -->
                        <div>
                            <h5 class="card-title mb-3"><i class="bi bi-file-earmark-ruled me-2"></i> Defined Criteria</h5>
                            <p class="card-text display-4 fw-bold text-primary" id="criteria-count">3</p>
                        </div>
                         <button class="btn btn-primary mt-3" onclick="showSection('porder-section', 'nav-porder')">Manage Criteria <i class="bi bi-arrow-right-short"></i></button> <!-- Changed to primary button -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- User Management Section -->
    <section id="users-section" class="content-section">
        <div class="section-header d-flex justify-content-between align-items-center flex-wrap">
            <h2><i class="bi bi-people-fill"></i> User Management</h2>
             <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createUserModal"> <!-- Larger button -->
                <i class="bi bi-plus-circle me-1"></i> Create New User
            </button>
        </div>
         <hr>
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Privileges</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="user-table-body">
                    <tr>
                        <td>admin_user</td>
                        <td>admin@example.com</td>
                        <td>Sub Admin (Full Access)</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-secondary me-1" title="Edit User"><i class="bi bi-pencil-square"></i></button> <!-- Changed icon -->
                            <button class="btn btn-sm btn-outline-danger" title="Delete User"><i class="bi bi-trash3"></i></button> <!-- Changed icon -->
                        </td>
                    </tr>
                     <!-- Sample Row Removed as per user code -->
                </tbody>
            </table>
        </div>
         <p id="no-users-message" class="text-muted mt-3" style="display: none;"><i class="bi bi-info-circle me-1"></i> No users found. Use the button above to add one.</p> <!-- Improved empty message -->
    </section>

    <!-- P-Order Criteria Section -->
    <section id="porder-section" class="content-section">
        <div class="section-header">
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                 <h2><i class="bi bi-filter-square-fill"></i> Manage Validation Criteria</h2>
                 <div class="role-view-selector mt-2 mt-md-0">
                     <span class="me-2 text-muted small">Simulate View As:</span>
                     <div class="btn-group shadow-sm" role="group" aria-label="Role view selector"> <!-- Added subtle shadow -->
                        <input type="radio" class="btn-check" name="roleView" id="viewAdmin" value="sub-admin" autocomplete="off" checked>
                        <label class="btn btn-outline-secondary" for="viewAdmin"><i class="bi bi-person-badge"></i> Sub-Admin</label>
                        <input type="radio" class="btn-check" name="roleView" id="viewPO" value="po-verifier" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="viewPO"><i class="bi bi-file-earmark-text"></i> PO Verifier</label>
                        <input type="radio" class="btn-check" name="roleView" id="viewATS" value="ats-verifier" autocomplete="off">
                        <label class="btn btn-outline-secondary" for="viewATS"><i class="bi bi-person-lines-fill"></i> ATS Verifier</label>
                    </div>
                 </div>
            </div>
            <hr>
        </div>

        <div class="row">
            <!-- PO Criteria Column -->
            <div class="col-lg-6 criteria-column mb-4 mb-lg-0" id="po-criteria-column">
                <div class="column-header">
                    <h3><i class="bi bi-file-earmark-text text-info"></i> PO Verification</h3>
                     <button class="btn btn-outline-primary btn-add-criteria" data-bs-toggle="modal" data-bs-target="#createPOrderCriteriaModal" data-criteria-type="po">
                         <i class="bi bi-plus-lg"></i> Add PO Criteria
                     </button>
                 </div>
                <div id="po-criteria-list" class="mt-3">
                    <!-- Sample PO Card 1 -->
                    <div class="card mb-3"> <div class="card-body"> <div class="d-flex justify-content-between align-items-start"> <div> <h5 class="card-title mb-1">Vendor Name Check</h5> <small class="text-muted d-block mb-2">Field: Vendor Name</small> </div> <span class="badge bg-info text-dark ms-2">PO</span> </div> <p class="card-text mb-2"><strong>Rule:</strong> Must exist in approved vendor list.</p> <div class="d-flex justify-content-between align-items-center"> <p class="card-text mb-0"><small class="text-muted-light">Confidence: <strong>85%</strong></small></p> <div class="text-end"> <button class="btn btn-sm btn-outline-secondary me-1" title="Edit Criteria"><i class="bi bi-pencil-square"></i></button> <button class="btn btn-sm btn-outline-danger" title="Delete Criteria"><i class="bi bi-trash3"></i></button> </div> </div> </div> </div>
                    <!-- Sample PO Card 2 -->
                     <div class="card mb-3"> <div class="card-body"> <div class="d-flex justify-content-between align-items-start"> <div> <h5 class="card-title mb-1">PO Number Format</h5> <small class="text-muted d-block mb-2">Field: PO Number</small> </div> <span class="badge bg-info text-dark ms-2">PO</span> </div> <p class="card-text mb-2"><strong>Rule:</strong> Must match pattern 'PO-######'.</p> <div class="d-flex justify-content-between align-items-center"> <p class="card-text mb-0"><small class="text-muted-light">Confidence: <strong>95%</strong></small></p> <div class="text-end"> <button class="btn btn-sm btn-outline-secondary me-1" title="Edit Criteria"><i class="bi bi-pencil-square"></i></button> <button class="btn btn-sm btn-outline-danger" title="Delete Criteria"><i class="bi bi-trash3"></i></button> </div> </div> </div> </div>
                    <!-- PO Criteria added by JS will go here -->
                </div>
                <p id="no-po-criteria-message" class="text-muted text-center mt-4 p-3 bg-light rounded" style="display: none;"><i class="bi bi-info-circle me-1"></i> No PO criteria defined. Click 'Add PO Criteria' to create one.</p>
            </div>

            <!-- ATS Criteria Column -->
            <div class="col-lg-6 criteria-column" id="ats-criteria-column">
                 <div class="column-header">
                    <h3><i class="bi bi-person-lines-fill text-success"></i> ATS Verification</h3>
                     <button class="btn btn-outline-success btn-add-criteria" data-bs-toggle="modal" data-bs-target="#createPOrderCriteriaModal" data-criteria-type="ats">
                         <i class="bi bi-plus-lg"></i> Add ATS Criteria
                     </button>
                </div>
                <div id="ats-criteria-list" class="mt-3">
                     <!-- Sample ATS Card -->
                    <div class="card mb-3"> <div class="card-body"> <div class="d-flex justify-content-between align-items-start"> <div> <h5 class="card-title mb-1">CV Keyword Match</h5> <small class="text-muted d-block mb-2">Field: Skills Section</small> </div> <span class="badge bg-success ms-2">ATS</span> </div> <p class="card-text mb-2"><strong>Rule:</strong> Must contain at least 3 keywords from job description.</p> <div class="d-flex justify-content-between align-items-center"> <p class="card-text mb-0"><small class="text-muted-light">Confidence: <strong>75%</strong></small></p> <div class="text-end"> <button class="btn btn-sm btn-outline-secondary me-1" title="Edit Criteria"><i class="bi bi-pencil-square"></i></button> <button class="btn btn-sm btn-outline-danger" title="Delete Criteria"><i class="bi bi-trash3"></i></button> </div> </div> </div> </div>
                    <!-- ATS Criteria added by JS will go here -->
                </div>
                 <p id="no-ats-criteria-message" class="text-muted text-center mt-4 p-3 bg-light rounded" style="display: none;"><i class="bi bi-info-circle me-1"></i> No ATS criteria defined. Click 'Add ATS Criteria' to create one.</p>
            </div>
        </div>
    </section>
    <!-- REMOVED Original ATS Section as per user's code -->

</div> <!-- /dashboard-content -->

<!-- Modals -->
<!-- Create User Modal -->
<div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="createUserModalLabel"><i class="bi bi-person-plus-fill me-2"></i> Create New User</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <div class="alert alert-danger d-none" role="alert" id="user-form-alert"></div> <form id="createUserForm" novalidate> <div class="mb-3"> <label for="username" class="form-label">Username <span class="text-danger">*</span></label> <input type="text" class="form-control" id="username" required> <div class="invalid-feedback">Please provide a username.</div> </div> <div class="mb-3"> <label for="email" class="form-label">Email address <span class="text-danger">*</span></label> <input type="email" class="form-control" id="email" required> <div class="invalid-feedback">Please provide a valid email address.</div> </div> <div class="mb-3"> <label for="password" class="form-label">Password <span class="text-danger">*</span></label> <input type="password" class="form-control" id="password" required> <div class="invalid-feedback">Please provide a password.</div> </div> <div class="mb-3"> <label class="form-label">Privileges <span class="text-danger">*</span></label> <div id="privilege-feedback" class="text-danger small mb-2 d-none">Please select at least one privilege.</div> <div class="form-check"> <input class="form-check-input" type="checkbox" value="admin" id="priv-admin" name="userPrivilege"> <label class="form-check-label" for="priv-admin">Sub Admin (Full Access)</label> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" value="ats-verifier" id="priv-ats-verify" name="userPrivilege"> <label class="form-check-label" for="priv-ats-verify">ATS Verifier</label> </div> <div class="form-check"> <input class="form-check-input" type="checkbox" value="po-verifier" id="priv-po-verify" name="userPrivilege"> <label class="form-check-label" for="priv-po-verify">PO Verifier</label> </div> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button> <button type="submit" class="btn btn-primary" form="createUserForm"><i class="bi bi-check-circle me-1"></i> Create User</button> </div> </div> </div>
</div>

 <!-- Create P-Order Criteria Modal -->
<div class="modal fade" id="createPOrderCriteriaModal" tabindex="-1" aria-labelledby="createPOrderCriteriaModalLabel" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="createPOrderCriteriaModalLabel"><i class="bi bi-plus-circle me-2"></i> Add New Validation Criteria</h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <div class="alert alert-danger d-none" role="alert" id="criteria-form-alert"></div> <form id="createPOrderCriteriaForm" novalidate> <div class="mb-3"> <label for="criteriaName" class="form-label">Criteria Name <span class="text-danger">*</span></label> <input type="text" class="form-control" id="criteriaName" placeholder="e.g., Validate PO Number Format" required> <div class="invalid-feedback">Please provide a name for the criteria.</div> </div> <div class="mb-3"> <label for="fieldToExtract" class="form-label">Field to Extract <span class="text-danger">*</span></label> <input type="text" class="form-control" id="fieldToExtract" placeholder="e.g., PO Number, Vendor Name" required> <div class="invalid-feedback">Please specify the field to extract.</div> </div> <div class="mb-3"> <label for="validationRule" class="form-label">Validation Rule / Description <span class="text-danger">*</span></label> <textarea class="form-control" id="validationRule" rows="3" placeholder="Describe the validation logic..." required></textarea> <div class="invalid-feedback">Please describe the validation rule.</div> </div> <div class="mb-3"> <label for="aiConfidence" class="form-label">AI Confidence Threshold (%) <span class="text-danger">*</span></label> <input type="number" class="form-control" id="aiConfidence" min="0" max="100" value="90" required> <div class="form-text">Minimum AI confidence required (0-100).</div> <div class="invalid-feedback">Please enter a confidence threshold between 0 and 100.</div> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button> <button type="submit" class="btn btn-primary" form="createPOrderCriteriaForm"><i class="bi bi-check-circle me-1"></i> Save Criteria</button> </div> </div> </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<!-- Custom JavaScript (No Functional Changes) -->
<script>
    function setInitialSection() {
        const hash = window.location.hash;
        let targetId = 'dashboard-section';
        let targetNavId = 'nav-dashboard';
        if (hash && hash.startsWith('#')) {
            const sectionName = hash.substring(1);
             if (document.getElementById(sectionName + '-section')) {
                targetId = sectionName + '-section';
                targetNavId = 'nav-' + sectionName;
            }
        }
         return { targetId, targetNavId };
    }
    const initialView = setInitialSection();

    document.addEventListener('DOMContentLoaded', () => {
        // --- Get Elements ---
        const navLinks = document.querySelectorAll('.sidebar .nav-link');
        // Explicitly get sections by ID as not all have content-section class
        const dashboardSection = document.getElementById('dashboard-section');
        const usersSection = document.getElementById('users-section');
        const porderSection = document.getElementById('porder-section');
        const allSections = [dashboardSection, usersSection, porderSection].filter(Boolean); // Filter out nulls if sections removed

        const createUserForm = document.getElementById('createUserForm');
        const createPOrderCriteriaForm = document.getElementById('createPOrderCriteriaForm');
        const userTableBody = document.getElementById('user-table-body');
        const noUsersMessage = document.getElementById('no-users-message');
        // Criteria Columns and Lists
        const poCriteriaColumn = document.getElementById('po-criteria-column');
        const atsCriteriaColumn = document.getElementById('ats-criteria-column');
        const poCriteriaList = document.getElementById('po-criteria-list');
        const atsCriteriaList = document.getElementById('ats-criteria-list');
        const noPoCriteriaMessage = document.getElementById('no-po-criteria-message');
        const noAtsCriteriaMessage = document.getElementById('no-ats-criteria-message');
        // Alerts
        const userFormAlert = document.getElementById('user-form-alert');
        const criteriaFormAlert = document.getElementById('criteria-form-alert');
        const privilegeFeedback = document.getElementById('privilege-feedback');
        // Role Simulation Buttons
        const roleViewButtons = document.querySelectorAll('input[name="roleView"]');
        // Add Criteria Buttons (now multiple)
        const addCriteriaButtons = document.querySelectorAll('.btn-add-criteria');

        // --- Get Modal Instances ---
        const createUserModalEl = document.getElementById('createUserModal');
        const createUserModalInstance = bootstrap.Modal.getOrCreateInstance(createUserModalEl);
        const createPOrderCriteriaModalEl = document.getElementById('createPOrderCriteriaModal');
        const createPOrderCriteriaModalInstance = bootstrap.Modal.getOrCreateInstance(createPOrderCriteriaModalEl);

        // --- State ---
        let currentSimulatedRole = 'sub-admin';

        // --- Navigation Handling ---
        navLinks.forEach(link => {
            if (link.getAttribute('href')?.startsWith('#')) {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const sectionName = link.getAttribute('href').substring(1);
                    const targetId = sectionName + '-section';
                    const targetNavId = link.id;
                    window.location.hash = sectionName; // Allow bookmarking/refresh
                    showSection(targetId, targetNavId);
                });
            }
        });

        // --- Function to Show/Hide Sections ---
        window.showSection = (targetId, targetNavId) => {
            allSections.forEach(section => { if(section) section.style.display = 'none'; });
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.style.display = 'block';
                if (targetId === 'porder-section') updateCriteriaColumnVisibility();
                if (targetId === 'users-section') checkUserTableEmpty();
            } else {
                console.warn(`Section with ID ${targetId} not found. Showing dashboard.`);
                if(dashboardSection) dashboardSection.style.display = 'block'; // Fallback
                targetNavId = 'nav-dashboard'; // Ensure dashboard link is active on fallback
            }
            // Update active nav link status
            navLinks.forEach(nav => {
                nav.classList.toggle('active', nav.id === targetNavId);
            });
        };

        // --- Role-Based Criteria Column Visibility ---
        function updateCriteriaColumnVisibility() {
            if (!poCriteriaColumn || !atsCriteriaColumn) return;
            const isPOVisible = (currentSimulatedRole === 'sub-admin' || currentSimulatedRole === 'po-verifier');
            const isATSVisible = (currentSimulatedRole === 'sub-admin' || currentSimulatedRole === 'ats-verifier');

            poCriteriaColumn.style.display = isPOVisible ? 'block' : 'none';
            atsCriteriaColumn.style.display = isATSVisible ? 'block' : 'none';

            const rowContainer = poCriteriaColumn.closest('.row');
            if (rowContainer) {
                rowContainer.classList.toggle('justify-content-center', !isPOVisible || !isATSVisible);
            }

            // Update 'no criteria' messages
            if (isPOVisible && noPoCriteriaMessage && poCriteriaList) noPoCriteriaMessage.style.display = poCriteriaList.children.length === 0 ? 'block' : 'none';
            else if(noPoCriteriaMessage) noPoCriteriaMessage.style.display = 'none';

            if (isATSVisible && noAtsCriteriaMessage && atsCriteriaList) noAtsCriteriaMessage.style.display = atsCriteriaList.children.length === 0 ? 'block' : 'none';
            else if(noAtsCriteriaMessage) noAtsCriteriaMessage.style.display = 'none';
        }

        // --- Event Listener for Role Simulation Buttons ---
        roleViewButtons.forEach(button => {
            button.addEventListener('change', (event) => {
                currentSimulatedRole = event.target.value;
                updateCriteriaColumnVisibility();
            });
        });

        // --- Event Listener for Add Criteria Buttons ---
        addCriteriaButtons.forEach(button => {
            button.addEventListener('click', () => {
                const criteriaType = button.dataset.criteriaType;
                createPOrderCriteriaModalEl.dataset.pendingCriteriaType = criteriaType;
                createPOrderCriteriaForm.classList.remove('was-validated');
                hideAlert(criteriaFormAlert);
                const modalTitle = createPOrderCriteriaModalEl.querySelector('.modal-title');
                if (modalTitle) {
                    modalTitle.innerHTML = `<i class="bi bi-plus-circle me-2"></i> Add New ${criteriaType.toUpperCase()} Validation Criteria`;
                }
                // Optional: Reset form fields if needed when opening modal
                 // createPOrderCriteriaForm.reset();
                 // document.getElementById('aiConfidence').value = 90; // Reset default
            });
        });

        // --- Check if User Table is Empty ---
        function checkUserTableEmpty() {
             if (userTableBody && noUsersMessage) {
                noUsersMessage.style.display = userTableBody.rows.length === 0 ? 'block' : 'none';
            }
        }

        // --- Form Handling ---
        // Create User Form Submission
        createUserForm.addEventListener('submit', (event) => {
            event.preventDefault();
            event.stopPropagation();
            hideAlert(userFormAlert);
            if(privilegeFeedback) privilegeFeedback.classList.add('d-none'); // Hide custom feedback

            const selectedPrivilegesCount = createUserForm.querySelectorAll('input[name="userPrivilege"]:checked').length;
            let privilegesValid = selectedPrivilegesCount > 0;

            if (!createUserForm.checkValidity() || !privilegesValid) {
                createUserForm.classList.add('was-validated');
                if (!privilegesValid && privilegeFeedback) privilegeFeedback.classList.remove('d-none');
                return;
            }
            createUserForm.classList.remove('was-validated');

            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const privileges = [];
             createUserForm.querySelectorAll('input[name="userPrivilege"]:checked').forEach(checkbox => {
                 const label = checkbox.closest('.form-check').querySelector('.form-check-label');
                 privileges.push(label ? label.textContent.trim() : checkbox.value);
            });

            console.log('Simulating User Creation:', { username, email, password: '***', privileges });
            addUserToTable(username, email, privileges);

            createUserForm.reset();
            createUserModalInstance.hide();
            updateDashboardCounts();
            checkUserTableEmpty();
        });

        // Add User Row Function
        function addUserToTable(username, email, privileges) {
            if (!userTableBody) return;
            const newRow = userTableBody.insertRow();
             newRow.innerHTML = `
                <td>${escapeHTML(username)}</td>
                <td>${escapeHTML(email)}</td>
                <td>${escapeHTML(privileges.join(', '))}</td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-secondary me-1" title="Edit User"><i class="bi bi-pencil-square"></i></button>
                    <button class="btn btn-sm btn-outline-danger" title="Delete User"><i class="bi bi-trash3"></i></button>
                </td>`;
        }

         // Create P-Order Criteria Form Submission
        createPOrderCriteriaForm.addEventListener('submit', (event) => {
            event.preventDefault();
            event.stopPropagation();
            hideAlert(criteriaFormAlert);

            const roleType = createPOrderCriteriaModalEl.dataset.pendingCriteriaType;

            if (!createPOrderCriteriaForm.checkValidity()) {
                 createPOrderCriteriaForm.classList.add('was-validated');
                 return;
            }
            if (!roleType) {
                 showAlert(criteriaFormAlert, "Could not determine criteria type. Please close the modal and click the 'Add' button again.", "danger");
                 return;
             }

            createPOrderCriteriaForm.classList.remove('was-validated');

            const criteriaName = document.getElementById('criteriaName').value.trim();
            const fieldToExtract = document.getElementById('fieldToExtract').value.trim();
            const validationRule = document.getElementById('validationRule').value.trim();
            const aiConfidence = document.getElementById('aiConfidence').value;

            console.log('Simulating Criteria Creation:', { criteriaName, fieldToExtract, validationRule, aiConfidence, roleType });
            addCriteriaCard(roleType, criteriaName, fieldToExtract, validationRule, aiConfidence);

            createPOrderCriteriaForm.reset();
            delete createPOrderCriteriaModalEl.dataset.pendingCriteriaType; // Clear stored type
            document.getElementById('aiConfidence').value = 90; // Reset default
            createPOrderCriteriaModalInstance.hide();
            updateDashboardCounts();
            updateCriteriaColumnVisibility(); // Update visibility and 'no criteria' messages
        });

        // Add Criteria Card Function
        function addCriteriaCard(roleType, name, field, rule, confidence) {
             const targetList = roleType === 'po' ? poCriteriaList : atsCriteriaList;
             if (!targetList) return;
             const roleBadgeClass = roleType === 'po' ? 'bg-info text-dark' : 'bg-success';
             const roleBadgeText = roleType === 'po' ? 'PO' : 'ATS';
             const newCriteriaCard = document.createElement('div');
             newCriteriaCard.className = 'card mb-3';
             newCriteriaCard.dataset.roleType = roleType;
             newCriteriaCard.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="card-title mb-1">${escapeHTML(name)}</h5>
                            <small class="text-muted d-block mb-2">Field: ${escapeHTML(field)}</small>
                        </div>
                        <span class="badge ${roleBadgeClass} ms-2">${roleBadgeText}</span>
                    </div>
                    <p class="card-text mb-2"><strong>Rule:</strong> ${escapeHTML(rule)}</p>
                    <div class="d-flex justify-content-between align-items-center">
                         <p class="card-text mb-0"><small class="text-muted-light">Confidence: <strong>${escapeHTML(confidence)}%</strong></small></p>
                         <div class="text-end">
                            <button class="btn btn-sm btn-outline-secondary me-1" title="Edit Criteria"><i class="bi bi-pencil-square"></i></button>
                            <button class="btn btn-sm btn-outline-danger" title="Delete Criteria"><i class="bi bi-trash3"></i></button>
                        </div>
                    </div>
                </div>`;
             targetList.appendChild(newCriteriaCard);
        }

        // --- Utility Functions ---
        function showAlert(alertElement, message, type = 'danger') {
            if (!alertElement) return;
            alertElement.className = `alert alert-${type} alert-dismissible fade show`;
            alertElement.innerHTML = `${escapeHTML(message)} <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            alertElement.classList.remove('d-none');
        }
        function hideAlert(alertElement) {
             if (!alertElement) return;
             alertElement.classList.add('d-none');
             alertElement.innerHTML = '';
        }
        function escapeHTML(str) {
            if (typeof str !== 'string') return str;
            const text = document.createTextNode(str);
            const p = document.createElement('p');
            p.appendChild(text);
            return p.innerHTML;
        }
        function updateDashboardCounts() {
            const userCountEl = document.getElementById('user-count');
            const criteriaCountEl = document.getElementById('criteria-count');
             if (userCountEl && userTableBody) userCountEl.textContent = userTableBody.rows.length;
             if (criteriaCountEl && poCriteriaList && atsCriteriaList) criteriaCountEl.textContent = poCriteriaList.querySelectorAll('.card').length + atsCriteriaList.querySelectorAll('.card').length;
        }

        // --- Initial Setup ---
        showSection(initialView.targetId, initialView.targetNavId);
        updateDashboardCounts();
        checkUserTableEmpty();

    }); // End DOMContentLoaded
</script>
</body>
</html>